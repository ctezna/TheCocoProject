{% extends 'layout.html' %}

{% block refresh %}

{% endblock %}

{% block style%}
<style>
@media only screen and (max-width: 500px) {
    
                }
</style>
{% endblock %}

{% block body %}
<div id="message"></div>
<a href="{{url_for('connectCoco')}}">
    <button class="btn btn btn-block mb-4" style="background-color: rgb(26,86,63);">
        <span data-feather="user-plus" class="mr-1" style="color:lightgray;"></span>
        <text style="color:lightgray;">{{ _('Add Coco') }}</text>
    </button>
</a>
{% for coco in cocos %}

<div class="card text-white mb-3" style="background-image: linear-gradient(to bottom,rgba(15,15,15,1), rgba(15,15,15,0.8));">
    <div class="card-header text-center">
        <a href="{{ url_for('cocoProfile', id=coco.id) }}" style="text-decoration: none; color: #ffffff;">
        <img src="{{url_for('static', filename='img/'+coco.img)}}" width="50" height="50" class="mr-2" style="display: inline-block; border-radius: 50%;" alt="Avatar">
        <h4 style="display: inline-block;">{{coco.name}}</h4>
        </a>
        <span id="lightOn{{coco.id}}" style="display: {% if coco.light == 1 %}inline-block;{% elif coco.light == 0 %}none;{% endif %}">
            <button type="button" 
            onclick="taskController('{{coco.proxy}}','{{coco.id}}',2)" 
            class="btn btn-warning btn-sm ml-3" 
            style="display: inline-block;">
                    <span data-feather="moon"></span>
            </button>
        </span>
        <span id="lightOff{{coco.id}}" style="display: {% if coco.light == 1 %}none;{% elif coco.light == 0 %}inline-block;{% endif %}">
            <button type="button" 
            onclick="taskController('{{coco.proxy}}','{{coco.id}}',1)" 
            class="btn btn-outline-warning btn-sm ml-3" 
            style="display: inline-block;">
                    <span data-feather="sun"></span>
            </button>
        </span>
        <button id="reboot;{{coco.id}}" class="btn btn btn-sm ml-3" 
        style="display: inline-block; background-color:rgb(26,86,63);" 
        onclick="taskController('{{coco.proxy}}','{{coco.id}}',5)"
        data-toggle="tooltip" data-placement="top" title="Use this to restart your Coco.">
            <span data-feather="power" style="color:lightgray;"></span>
        </button>
    </div>
    <div class="card-body text-center">
        <div id="vid" class="vid-container mb-3">
            <button id="play;{{coco.id}}" style="background-image: linear-gradient(to bottom, rgb(33,33,33), rgb(100,100,100));" 
            class="btn btn" onclick="playVid('{{coco.id}}')">
                <span data-feather="video" style="color:lightgray;" class="mr-1"></span>
                <text style="color: lightgray;">{{_('Play Stream')}}</text>
            </button>
            <img id="frame{{coco.id}}" class="videoFeed m-1" style="display:none;" src="">
            <img id="loading{{coco.id}}" style="display:none;" src="{{url_for('static',filename='img/loading.gif')}}">
        </div>


        <button id="refresh;{{coco.id}}" style="display:none; background-color: rgb(26,86,63);" 
        class="btn btn" onclick="proxyGen('{{coco.id}}')">
            <span data-feather="refresh-cw" style="color: lightgray;"></span>
        </button>
        <button id="stop;{{coco.id}}" style="display:none; background-color: rgb(205,103,122);" 
        class="btn btn" onclick="stopVid('{{coco.id}}', '{{coco.proxy}}')">
            <span data-feather="video-off"></span>
        </button>
        <button id="ring;{{coco.id}}" style="display:none; background-color: rgb(26,86,63);" 
        class="btn btn" onclick="taskController('{{coco.proxy}}','{{coco.id}}',3)" disabled>
            <span data-feather="bell" style="color: lightgray;"></span>
        </button>
    </div>
    <div class="card-footer text-center" id="container">
        <button id="routine;{{coco.id}}" style="background-color: rgb(26,86,63);" data-toggle="modal" 
        data-id="{{coco.proxy}}" data-target="#modalForm" class="open-AddRoutine btn btn">
            <span data-feather="plus-circle" style="color: lightgray;" class="mr-1"></span>
            <text id="big" style="color: lightgray;">{{ _('Add Routine')}}</text>
        </button>
        <button id="feed{{coco.id}}" onclick="taskController('{{coco.proxy}}', '{{coco.id}}', 0)" 
            class="btn btn" style="float: left;background-color: rgb(26,86,63);">
            <i class="material-icons mr-1" style="color: lightgray;">fastfood</i>
            <text id="big" style="color: lightgray;" >{{_('Feed Coco')}}</text>
        </button>
        <button id="delete;{{coco.id}}" data-toggle="modal" data-id="{{coco.id}}" data-target="#modalDelete{{coco.id}}" 
        class="open-DeleteModal btn btn" style="float:right; background-color: rgb(205,103,122);">
            <span data-feather="x" class="mr-1"></span>
            <text id="big">{{_('Delete Coco')}}</text>
        </button>
    </div>
</div>

<div class="modal fade" id="modalDelete{{coco.id}}" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title" id="exampleModalCenterTitle">{{_('Removing Coco.')}}</h5>
        </div>
        <div class="modal-body" id="deleteBody">
            <p>{{_('Please confirm action, removing Coco is irreversible.')}}
            </p>
            <label>{{_('Do you wish to remove Coco from list?')}}</label>
        </div>
        <div class="modal-footer">
            {% set url = url_for('deleteCoco', id=coco.id) %}
            <button class="btn btn" onclick="deleteData('{{url}}')" style="display:inline-block; background-color: rgb(205,103,122);">
                <span data-feather="check"></span>{{_('Yes')}}
            </button>
            <button class="btn btn" data-dismiss="modal" style="display:inline-block; background-color: rgb(26,86,63);">
                <span data-feather="x"></span>No
            </button>
        </div>
        </div>
    </div>
</div>
{% endfor %}
<div class="modal fade" id="modalForm" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title" id="exampleModalCenterTitle">{{_('Add New Routine')}}</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
            <form action="{{ url_for('index') }}" method="post">
                {{ form.hidden_tag() }}
                <p>
                    {{ form.task.label }} {{ form.task() }}
                    <small class="text-muted">
                        {{_('Light turns off after 1 hour.')}}
                    </small><br>
                </p>
                <p>{{ form.days.label }}</p>
                <p>
                    {{ form.mon()}}{{ form.mon.label}} {{ form.tue()}}{{ form.tue.label}}
                    {{ form.wed()}}{{ form.wed.label}} {{ form.thur()}}{{ form.thur.label}}
                    {{ form.fri()}}{{ form.fri.label}} {{ form.sat()}}{{ form.sat.label}} {{ form.sun()}}{{ form.sun.label}}
                </p>
                <p>
                    {{ form.times.label }}
                    {{ form.times(class="form-control", placeholder="10:00, 15:45, 22:30", size=32)}}
                </p>

                    {{ form.proxy(style="display:none;")}}
                <small class="text-muted">
                    {{_('Please use 24 hour clock with intervals of 15 minutes. Separate times with commas.')}}
                </small><br>
        </div>
        <div class="modal-footer">
                <p>{{ form.submit(class="btn btn-block", style="background-color:rgb(38,138,241); color: lightgray;") }}</p>
            </form>
        </div>
        </div>
    </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script>
    $(function() {
        var cocoIds = [];
        {% for coco in cocos %}
            cocoIds.push({{coco.id}});
        {% endfor %}
        if (cocoIds.length > 0){
            $.ajax('/proxyGen/'+ cocoIds).done(function(data){

            });
        }
    });
</script>
<script>
    $(document).on("click", ".open-AddRoutine", function () {
     var proxy = $(this).data('id');
     $(".modal-body #proxy").val( proxy );
    });
</script>

<script>
    // when you are in fullscreen, ESC and F11 may not be trigger by keydown listener. 
    // so don't use it to detect exit fullscreen
    document.addEventListener('keydown', function (e) {
    console.log('key press' + e.keyCode);
    });
    // detect enter or exit fullscreen mode
    document.addEventListener('webkitfullscreenchange', fullscreenChange);
    document.addEventListener('mozfullscreenchange', fullscreenChange);
    document.addEventListener('fullscreenchange', fullscreenChange);
    document.addEventListener('MSFullscreenChange', fullscreenChange);

    
</script>


{% endblock %}