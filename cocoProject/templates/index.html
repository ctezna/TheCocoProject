{% extends 'layout.html' %}

{% block refresh %}

{% endblock %}

{% block style%}
<style>
   /* .iframe-container {
  overflow: scroll;
  padding-top: 56.25%;
  position: relative;
}
 
.iframe-container iframe {
   border: 0;
   height: 100%;
   left: 0;
   position: absolute;
   top: 0;
   width: 100%;
}
 
/* 4x3 Aspect Ratio */
/* .iframe-container-4x3 {
  padding-top: 75%;
} */
@media only screen and (max-width: 500px) {
                    .videoFeed{
                        width:100%;
                        height: 250px;
                    }
    
                }
</style>
{% endblock %}

{% block body %}
<div id="message"></div>
<a href="{{url_for('connectCoco')}}">
    <button class="btn btn-success btn-block mb-4">
        <span data-feather="user-plus" class="mr-1"></span>
        {{ _('Add Coco') }}
    </button>
</a>
{% for coco in cocos %}

<div class="card text-white bg-dark mb-3">
    <div class="card-header text-center">
        <a href="{{ url_for('cocoProfile', id=coco.id) }}" style="text-decoration: none; color: #ffffff;">
        <img src="{{url_for('static', filename='img/'+coco.img)}}" width="50" height="50" class="mr-2" style="display: inline-block; border-radius: 50%;" alt="Avatar">
        <h4 style="display: inline-block;">{{coco.name}}</h4>
        </a>
        <span id="light{{coco.id}}">
            <button type="button" 
            onclick="taskController('{{coco.proxy}}','{{coco.id}}',{% if coco.light == 1 %}2{% elif coco.light == 0 %}1{% endif %})" 
            class="btn btn-{% if coco.light == 1 %}{% elif coco.light == 0 %}outline-{% endif %}warning btn-sm ml-3" 
            style="display: inline-block;">
                    <span data-feather="{% if coco.light == 1 %}moon{% elif coco.light == 0 %}sun{% endif %}"></span>
            </button>
        </span>
        <a href="{{url_for('reboot', id=coco.id)}}">
                <button id="refresh;{{coco.id}}" class="btn btn-info btn-sm ml-3" style="display: inline-block;" data-toggle="tooltip" data-placement="top" title="Use this to restart your Coco."><span data-feather="power"></span></button>
        </a>
    </div>
    <div class="card-body text-center">
        <div id="vid" class="iframe-container">
            <button id="play;{{coco.id}}" class="btn btn-primary" onclick="playVid('{{coco.id}}')"><span data-feather="video" class="mr-1"></span>{{_('Play Stream')}}</button>
            <iframe id='frame;{{coco.id}}' class="videoFeed" style="display:none; width: 100%; height: 535px;" src="{{coco.proxy}}/camera" >{{ _('iFrame not supported by your browser.')}}</iframe>
               
        </div>



        <button id="stop;{{coco.id}}" style="display:none;" class="btn btn-danger" onclick="stopVid('{{coco.id}}')"><span data-feather="video-off"></span></button>
        <button id="ring;{{coco.id}}" style="display:none;" class="btn btn-secondary" onclick="taskController('{{coco.proxy}}','{{coco.id}}',3)" disabled><span data-feather="bell"></span></button>
    </div>
    <div class="card-footer text-center" id="container">
        <button id="fullscreen;{{coco.id}}" onclick="fullscreen()" class="fullscreen btn btn-success" style="display:none;"><span data-feather="maximize-2" class="mr-1"></span><text id="big">{{ _('Fullscreen')}}</text></button>
        <button id="routine;{{coco.id}}" data-toggle="modal" data-id="{{coco.proxy}}" data-target="#modalForm" class="open-AddRoutine btn btn-success"><span data-feather="plus-circle" class="mr-1"></span><text id="big">{{ _('Add Routine')}}</text></button>
        <button onclick="taskController('{{coco.proxy}}', '{{coco.id}}', 0)" class="btn btn-success" style="float:left"><span data-feather="smile" class="mr-1"></span><text>{{_('Feed Coco')}}</text></button>
        <button id="delete;{{coco.id}}" data-toggle="modal" data-id="{{coco.id}}" data-target="#modalDelete{{coco.id}}" class="open-DeleteModal btn btn-danger" style="float:right"><span data-feather="x" class="mr-1"></span><text id="big">{{_('Delete Coco')}}</text></button>
    </div>
</div>

<div class="modal fade" id="modalDelete{{coco.id}}" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title" id="exampleModalCenterTitle">{{_('Removing Coco.')}}</h5>
        </div>
        <div class="modal-body" id="deleteBody">
            <p>{{_('Please confirm action, removing Coco is irreversible.')}}
            </p>
            <label>{{_('Do you wish to remove Coco from list?')}}</label>
        </div>
        <div class="modal-footer">
            {% set url = url_for('deleteCoco', id=coco.id) %}
            <button class="btn btn-danger" onclick="deleteData('{{url}}')" style="display:inline-block;"><span data-feather="check"></span>{{_('Yes')}}</button>
            <button class="btn btn-success" data-dismiss="modal" style="display:inline-block;"><span data-feather="x"></span>No</button>
        </div>
        </div>
    </div>
</div>
{% endfor %}
<div class="modal fade" id="modalForm" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title" id="exampleModalCenterTitle">{{_('Add New Routine')}}</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
            <form action="{{ url_for('index') }}" method="post">
                {{ form.hidden_tag() }}
                <p>
                    {{ form.task.label }} {{ form.task() }}
                    <small class="text-muted">
                        {{_('Light turns off after 1 hour.')}}
                    </small><br>
                </p>
                <p>{{ form.days.label }}</p>
                <p>
                    {{ form.mon()}}{{ form.mon.label}} {{ form.tue()}}{{ form.tue.label}}
                    {{ form.wed()}}{{ form.wed.label}} {{ form.thur()}}{{ form.thur.label}}
                    {{ form.fri()}}{{ form.fri.label}} {{ form.sat()}}{{ form.sat.label}} {{ form.sun()}}{{ form.sun.label}}
                </p>
                <p>
                    {{ form.times.label }}
                    {{ form.times(class="form-control", placeholder="10:00, 15:45, 22:30", size=32)}}
                </p>

                    {{ form.proxy(style="display:none;")}}
                <small class="text-muted">
                    {{_('Please use 24 hour clock with intervals of 15 minutes. Separate times with commas.')}}
                </small><br>
        </div>
        <div class="modal-footer">
                <p>{{ form.submit(class="btn btn-primary btn-block") }}</p>
            </form>
        </div>
        </div>
    </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script>
    $(function() {
        var cocoIds = [];
        {% for coco in cocos %}
            cocoIds.push({{coco.id}});
        {% endfor %}
        if (cocoIds.length > 0){
            $.ajax('/proxyGen/'+ cocoIds).done(function(data){

            });
        }
    });
</script>
<script>
    $(document).on("click", ".open-AddRoutine", function () {
     var proxy = $(this).data('id');
     $(".modal-body #proxy").val( proxy );
    });
</script>

<script>
    // when you are in fullscreen, ESC and F11 may not be trigger by keydown listener. 
    // so don't use it to detect exit fullscreen
    document.addEventListener('keydown', function (e) {
    console.log('key press' + e.keyCode);
    });
    // detect enter or exit fullscreen mode
    document.addEventListener('webkitfullscreenchange', fullscreenChange);
    document.addEventListener('mozfullscreenchange', fullscreenChange);
    document.addEventListener('fullscreenchange', fullscreenChange);
    document.addEventListener('MSFullscreenChange', fullscreenChange);

    
</script>


{% endblock %}